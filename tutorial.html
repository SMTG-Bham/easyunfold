

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Tutorial &#8212; easyunfold</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorial';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Examples" href="examples.html" />
    <link rel="prev" title="Installation" href="installation.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.svg" class="logo__image only-light" alt="easyunfold - Home"/>
    <script>document.write(`<img src="_static/logo.svg" class="logo__image only-dark" alt="easyunfold - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/SMTG-Bham/easyunfold" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/easyunfold/" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="https://img.shields.io/pypi/v/easyunfold" class="icon-link-image" alt="PyPI"/></a>
        </li>
</ul></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="index.html">
                    easyunfold Documentation
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Tutorial</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="examples.html">Examples</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="examples/example_si222.html">Silicon with a displaced atom</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/example_mgo.html">MgO with atomic projections, effective masses &amp; defects</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/example_nabis2.html">Disordered NaBiS<sub>2</sub> with atomic/orbital projections &amp; DOS plotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/example_si211_castep.html">Si supercell using CASTEP</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="theory.html">Band Unfolding Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">CLI Reference</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="apidocs/index.html">API Reference</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="apidocs/easyunfold/easyunfold.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">easyunfold</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="apidocs/easyunfold/easyunfold.cli.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">easyunfold.cli</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="apidocs/easyunfold/easyunfold.wavecar.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">easyunfold.wavecar</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="apidocs/easyunfold/easyunfold.wavefun.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">easyunfold.wavefun</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="apidocs/easyunfold/easyunfold.vasp_constant.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">easyunfold.vasp_constant</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="apidocs/easyunfold/easyunfold.plotting.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">easyunfold.plotting</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="apidocs/easyunfold/easyunfold.effective_mass.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">easyunfold.effective_mass</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="apidocs/easyunfold/easyunfold.procar.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">easyunfold.procar</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="apidocs/easyunfold/easyunfold.utils.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">easyunfold.utils</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="apidocs/easyunfold/easyunfold.unfold.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">easyunfold.unfold</span></code></a></li>
</ul>
</details></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/SMTG-Bham/easyunfold" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/tutorial.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Tutorial</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-generate-the-k-point-path-for-the-primitive-cell">Step 1 - Generate the <em>k</em>-point path for the primitive cell</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-generate-the-k-point-path-for-the-supercell-calculation">Step 2 - Generate the <em>k</em>-point path for the supercell calculation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-perform-the-unfolding">Step 3 - Perform the unfolding</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-plot-the-results">Step 4 - Plot the results</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="tutorial">
<h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this heading">#</a></h1>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>See the <a class="reference external" href="https://youtu.be/9zeABbd1r1U?si=Oix3Bamiw8DZaMO4"><code class="docutils literal notranslate"><span class="pre">easyunfold</span></code> YouTube tutorial</a> for a quick overview of the theory of band structure unfolding, and a walkthrough of the calculation &amp; analysis workflow with <code class="docutils literal notranslate"><span class="pre">easyunfold</span></code>.</p>
</div>
<p>The main goal of <code class="docutils literal notranslate"><span class="pre">easyunfold</span></code> is to make the band structure unfolding workflow easier to implement and
less error-prone. To generate an unfolded band structure, one typically needs to perform the following
steps:</p>
<ol class="arabic simple">
<li><p>Create a primitive unit cell, and generate a band structure <em>k</em>-point path corresponding to this
primitive cell.</p></li>
<li><p>Create a supercell (e.g. disordered, defective, surface slab etc.), and obtain its optimised structure.</p></li>
<li><p>Generate a series of <em>k</em>-points for the supercell to be calculated.</p></li>
<li><p>Perform a band structure calculation with the supercell, and save its wavefunction output to file.</p></li>
<li><p>Post-process the supercell wavefunction to obtain the unfolded band structure in the <em>k</em>-point path
of the primitive unit cell.</p></li>
</ol>
<p>These generation and analysis steps are automated in <code class="docutils literal notranslate"><span class="pre">easyunfold</span></code>, with only the primitive unit cell and
supercell structures required as inputs from the user.</p>
<p>Typically, the supercell comprises some form of symmetry-breaking relative to the primitive cell, such
as defects, disorder (e.g. special quasi-random structures (SQS) for site disorder – other forms of
disorder such as magnetic, dynamic/vibrational, polar, elastic etc. also possible), or a surface/interface
slab.
In all cases, the supercell symmetry is lowered compared to the pristine primitive cell.
Hence, for a given <em>k</em>-point path in the primitive cell Brillouin Zone, additional <em>k</em>-points are
required to be sampled for the supercell, and the extracted spectral weights need to be appropriately
averaged to obtain the correct effective band structure (EBS). See the docs
<a class="reference external" href="https://smtg-Bham.github.io/easyunfold/theory.html">Theory</a> page and/or <a class="reference external" href="https://doi.org/10.21105/joss.05974">JOSS paper</a> for more details.</p>
<p>At the moment, two plane-wave DFT codes, VASP<a class="footnote-reference brackets" href="#vasp" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> and CASTEP<a class="footnote-reference brackets" href="#castep" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>, are supported. In principle,
support can be easily added for other plane-wave codes if the wavefunction can be read in.</p>
<p>Below is a guide for performing band structure unfolding when using VASP.</p>
<section id="step-1-generate-the-k-point-path-for-the-primitive-cell">
<h2>Step 1 - Generate the <em>k</em>-point path for the primitive cell<a class="headerlink" href="#step-1-generate-the-k-point-path-for-the-primitive-cell" title="Permalink to this heading">#</a></h2>
<p>In this step, we first generate the band structure <em>k</em>-point path we want to calculate. To do this, we use the prototype <em>high-symmetry primitive</em> structure to get the corresponding <em>k</em>-point path.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For disordered materials, this primitive cell should be the idealised primitive cell of the material (i.e. the primitive structure where all disordered sites have been set equal), not the SQS cell, and for defect supercells this should be the <em>primitive</em> cell of the host compound, not the bulk supercell.</p>
</div>
<p>This can be done by well-established packages such as
<a class="reference external" href="https://www.materialscloud.org/work/tools/seekpath">seekpath</a> or
<a class="reference external" href="https://github.com/SMTG-Bham/sumo">sumo</a>.
Note that the “standardised” primitive cell may be different from your input structure,
and the generated path is correct for the standard primitive cell only.
We recommend using <a class="reference external" href="https://github.com/SMTG-Bham/sumo">sumo</a> for generating the <em>k</em>-points, which provides
a nice command line interface, and automatically informs you if your input structure is not the required
‘standardised’ primitive cell:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sumo</span><span class="o">-</span><span class="n">kgen</span> <span class="o">-</span><span class="n">p</span> <span class="n">POSCAR</span>
</pre></div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">POSCAR_prim</span></code> file will be written out if <code class="docutils literal notranslate"><span class="pre">sumo</span></code> detects that the input structure is not the required
‘standardised’ primitive cell. If this is the case, the <code class="docutils literal notranslate"><span class="pre">POSCAR_prim</span></code> file should be used for further
supercell generation (or at least ensure that the supercell and the standardised primitive cell are
commensurate, with matching lattice parameters between <code class="docutils literal notranslate"><span class="pre">POSCAR_prim</span></code> and that used for supercell
generation).</p>
<p>The <em>k</em>-point path is written to <code class="docutils literal notranslate"><span class="pre">KPOINTS_band</span></code>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><code class="docutils literal notranslate"><span class="pre">sumo</span></code> can be installed with <code class="docutils literal notranslate"><span class="pre">pip</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>sumo
</pre></div>
</div>
</div>
</section>
<section id="step-2-generate-the-k-point-path-for-the-supercell-calculation">
<h2>Step 2 - Generate the <em>k</em>-point path for the supercell calculation<a class="headerlink" href="#step-2-generate-the-k-point-path-for-the-supercell-calculation" title="Permalink to this heading">#</a></h2>
<p>At this point, you should have your relaxed supercell structure (which likely has a lower symmetry than
the pristine primitive unit cell).
For LDA/GGA DFT calculations, the set of <em>k</em>-points for the supercell band structure can be generated with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">easyunfold</span> <span class="n">generate</span> <span class="n">primitive</span><span class="o">/</span><span class="n">POSCAR</span> <span class="n">supercell</span><span class="o">/</span><span class="n">POSCAR</span> <span class="n">primitive</span><span class="o">/</span><span class="n">KPOINTS_band</span> <span class="o">--</span><span class="n">matrix</span> <span class="s2">&quot;2 2 2&quot;</span>
</pre></div>
</div>
<p>For hybrid DFT band structure calculations, the electronic minimisation must be conducted self-consistently
(i.e. <code class="docutils literal notranslate"><span class="pre">ICHARG&lt;10</span></code>) as discussed on the
<a class="reference external" href="https://www.vasp.at/wiki/index.php/Band-structure_calculation_using_hybrid_functionals">VASPwiki</a>, and so in this case
we need to provide an <code class="docutils literal notranslate"><span class="pre">IBZKPT</span></code> file (e.g. from a previous SCF calculation for the supercell structure) using the
<code class="docutils literal notranslate"><span class="pre">--scf-kpoints</span></code> option, for which the <em>k</em>-points will be included with their original weights, and all band structure
<em>k</em>-points included by <code class="docutils literal notranslate"><span class="pre">easyunfold</span></code> will then be added as zero-weighted <em>k</em>-points. For hybrid DFT calculations, it can
also be useful to split the <em>k</em>-points into multiple calculations to reduce the computational overhead and/or memory
consumption, and this can be done with the <code class="docutils literal notranslate"><span class="pre">--nk-per-split</span></code> option, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">easyunfold</span> <span class="n">generate</span> <span class="n">primitive</span><span class="o">/</span><span class="n">POSCAR</span> <span class="n">supercell</span><span class="o">/</span><span class="n">POSCAR</span> <span class="n">primitive</span><span class="o">/</span><span class="n">KPOINTS_band</span> <span class="o">--</span><span class="n">matrix</span> <span class="s2">&quot;2 2 2&quot;</span> <span class="o">--</span><span class="n">nk</span><span class="o">-</span><span class="n">per</span><span class="o">-</span><span class="n">split</span> <span class="mi">60</span> <span class="o">--</span><span class="n">scf</span><span class="o">-</span><span class="n">kpoints</span> <span class="n">supercell</span><span class="o">/</span><span class="n">IBZKPT</span>
</pre></div>
</div>
<p>This will generate files named as <code class="docutils literal notranslate"><span class="pre">KPOINTS_easyunfold_001</span></code>, <code class="docutils literal notranslate"><span class="pre">KPOINTS_easyunfold_002</span></code>, each containing
60 zero-weighted <em>k</em>-points on top of the weighted SCF <em>k</em>-points.</p>
<p>See the help message with <code class="docutils literal notranslate"><span class="pre">easyunfold</span> <span class="pre">generate</span> <span class="pre">-h</span></code> for more details.
Note that the <code class="docutils literal notranslate"><span class="pre">--matrix</span></code> input is for setting the transformation matrix such that</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cell_super</span> <span class="o">=</span> <span class="n">M</span> <span class="o">@</span> <span class="n">cell_primitive</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">cell_super</span></code> and <code class="docutils literal notranslate"><span class="pre">cell_primitive</span></code> are (3,3) matrices made of <strong>row vectors</strong>.
If <code class="docutils literal notranslate"><span class="pre">M</span></code> is non-diagonal, all nine elements must be passed in a row-major order.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">--matrix</span></code> argument may be omitted (and automatically detected by <code class="docutils literal notranslate"><span class="pre">easyunfol</span></code>) if the supercell is
perfectly commensurate with the primitive cell, which is the case if the supercell calculation did not
undergo cell relaxation (typically the case for defect calculations).</p>
<p>If cell relaxation did take place, it is important to note that the unfolded band structure does not
correspond exactly to the Brillouin Zone of the original primitive cell, but to that of a primitive cell
deformed in a similar way to the supercell relaxation.</p>
<p>An <code class="docutils literal notranslate"><span class="pre">easyunfold.json</span></code> file will be written which contains the information of the <em>k</em>-point unfolding
calculation. The supercell <em>k</em>-points to be calculated are written to a file named <code class="docutils literal notranslate"><span class="pre">KPOINTS_easyunfold</span></code>.
It is possible to change the name <code class="docutils literal notranslate"><span class="pre">easyunfold</span></code> by passing an explicit tag with the <code class="docutils literal notranslate"><span class="pre">--out-file</span></code> option.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Input files for CASTEP can be generated with option <code class="docutils literal notranslate"><span class="pre">--code</span> <span class="pre">castep</span></code>.
In this case, the <code class="docutils literal notranslate"><span class="pre">&lt;seed&gt;.cell</span></code> file should be passed containing the primitive cell <em>k</em>-points that are
stored under the <code class="docutils literal notranslate"><span class="pre">spectral_kpoints_list</span></code> block.
The <code class="docutils literal notranslate"><span class="pre">cell</span></code> file of the supercell structure will be used as a template for generating a single <code class="docutils literal notranslate"><span class="pre">cell</span></code>
file containing the supercell <em>k</em>-points stored under the <code class="docutils literal notranslate"><span class="pre">spectral_kpoints_list</span></code> block.
The choice of the DFT code is stored in the data file (<code class="docutils literal notranslate"><span class="pre">easyunfold.json</span></code>) and will be used
automatically in later steps.</p>
</div>
</section>
<section id="step-3-perform-the-unfolding">
<h2>Step 3 - Perform the unfolding<a class="headerlink" href="#step-3-perform-the-unfolding" title="Permalink to this heading">#</a></h2>
<p>At this point, a supercell calculation should be completed with a <code class="docutils literal notranslate"><span class="pre">WAVECAR</span></code> (containing the plane wave
coefficients) written, containing all the <em>k</em>-points in the generated <code class="docutils literal notranslate"><span class="pre">KPOINTS_easyunfold</span></code> file.
This is typically a non-self-consistent calculation with <code class="docutils literal notranslate"><span class="pre">ICHARG=11</span></code> for standard (LDA/GGA) DFT, or a
self-consistent calculation with zero-weighted <em>k</em>-points if hybrid functionals are used (see
<a class="reference external" href="https://www.vasp.at/wiki/index.php/Band-structure_calculation_using_hybrid_functionals">VASPwiki</a>).</p>
<p>To compute the spectral weights, we run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">easyunfold</span> <span class="n">unfold</span> <span class="n">calculate</span> <span class="n">WAVECAR</span>
</pre></div>
</div>
<p>This command computes the spectral weights and save them to the <code class="docutils literal notranslate"><span class="pre">easyunfold.json</span></code> file.
You can load the <code class="docutils literal notranslate"><span class="pre">easyunfold.json</span></code> file to read the spectral weights manually, or proceed with the
command line interface to generate a plot.</p>
<p>If the <em>k</em>-points have been split into multiple calculations (for example, for those involving hybrid
functionals), all wave function files (e.g. <code class="docutils literal notranslate"><span class="pre">WAVECAR</span></code> for VASP) need to be passed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">easyunfold</span> <span class="n">unfold</span> <span class="n">calculate</span> <span class="n">calc1</span><span class="o">/</span><span class="n">WAVECAR</span> <span class="n">calc2</span><span class="o">/</span><span class="n">WAVECAR</span>  <span class="c1"># or &#39;calc*/WAVECAR&#39; </span>
</pre></div>
</div>
<p>For large <code class="docutils literal notranslate"><span class="pre">WAVECAR</span></code>s, it may take some time to parse and compute the weights. Note you should use the <code class="docutils literal notranslate"><span class="pre">--gamma</span></code> and/or
<code class="docutils literal notranslate"><span class="pre">--ncl</span></code> options if the calculation has <span class="math notranslate nohighlight">\(\Gamma\)</span>-only <em>k</em>-points or non-collinear spins (i.e. spin-orbit coupling),
respectively.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Wave functions (plane wave coefficients) in a CASTEP spectral calculation are stored in the <code class="docutils literal notranslate"><span class="pre">&lt;seed&gt;.</span> <span class="pre">orbitals</span></code> file, and the <code class="docutils literal notranslate"><span class="pre">&lt;seed&gt;.check</span></code> file only contains the wave function for the self-consistent field
calculation. Note that the former is not written by default, and needs to be turned on by setting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">write_orbitals</span> <span class="p">:</span> <span class="n">true</span>
</pre></div>
</div>
<p>in the <code class="docutils literal notranslate"><span class="pre">&lt;seed&gt;.param</span></code> file.</p>
</div>
</section>
<section id="step-4-plot-the-results">
<h2>Step 4 - Plot the results<a class="headerlink" href="#step-4-plot-the-results" title="Permalink to this heading">#</a></h2>
<p>Simply do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">easyunfold</span> <span class="n">unfold</span> <span class="n">plot</span>
</pre></div>
</div>
<p>to generate a plot of the spectral function, giving an output like this:</p>
<figure class="align-default" id="id3">
<a class="reference internal image-reference" href="_images/NaBiS2_unfold-plot.png"><img alt="NaBiS2 unfolded band structure" src="_images/NaBiS2_unfold-plot.png" style="width: 400px;" /></a>
<figcaption>
<p><span class="caption-text">Unfolded band structure of <span class="math notranslate nohighlight">\(\ce{NaBiS2}\)</span></span><a class="headerlink" href="#id3" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>It is possible to further customise the plot though command line arguments - see the help message with
<code class="docutils literal notranslate"><span class="pre">easyunfold</span> <span class="pre">unfold</span> <span class="pre">plot</span> <span class="pre">--help</span></code>, with outputs like:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-center"><p>BuPu <code class="docutils literal notranslate"><span class="pre">cmap</span></code></p></th>
<th class="head text-center"><p>viridis <code class="docutils literal notranslate"><span class="pre">cmap</span></code></p></th>
<th class="head text-center"><p>atom-projected</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-center"><p><img alt="" src="_images/NaBiS2_unfold-plot_BuPu.png" /></p></td>
<td class="text-center"><p><img alt="" src="_images/NaBiS2_unfold-plot_viridis.png" /></p></td>
<td class="text-center"><p><a class="reference internal" href="_images/NaBiS2_unfold-plot_proj.png"><img alt="atom-projected NaBiS2 band structure" src="_images/NaBiS2_unfold-plot_proj.png" style="width: 1200px;" /></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Figure can be further customised by passing a path to a matplotlib style sheet file, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">easyunfold</span> <span class="n">unfold</span> <span class="o">--</span><span class="n">mpl</span><span class="o">-</span><span class="n">style</span><span class="o">-</span><span class="n">file</span> <span class="o">&lt;</span><span class="n">path</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">mpl</span><span class="o">-</span><span class="n">style</span><span class="o">-</span><span class="n">sheet</span><span class="o">&gt;</span> <span class="n">plot</span>
</pre></div>
</div>
<p>which can be used to change the font, font sizes, ticks styles etc.
Read more on <a class="reference external" href="https://matplotlib.org/stable/tutorials/introductory/customizing.html#using-style-sheets">the matplotlib tutorial page</a>.</p>
</div>
<hr class="footnotes docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="vasp" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://www.vasp.at">https://www.vasp.at</a></p>
</aside>
<aside class="footnote brackets" id="castep" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="http://www.castep.org">http://www.castep.org</a></p>
</aside>
</aside>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="installation.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Installation</p>
      </div>
    </a>
    <a class="right-next"
       href="examples.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Examples</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-generate-the-k-point-path-for-the-primitive-cell">Step 1 - Generate the <em>k</em>-point path for the primitive cell</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-generate-the-k-point-path-for-the-supercell-calculation">Step 2 - Generate the <em>k</em>-point path for the supercell calculation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-perform-the-unfolding">Step 3 - Perform the unfolding</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-plot-the-results">Step 4 - Plot the results</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Bonan Zhu, Seán Kavanagh
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023, Bonan Zhu.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>